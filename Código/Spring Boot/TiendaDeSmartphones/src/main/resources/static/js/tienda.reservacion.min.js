/**
 * Created by Mauricio on 05/06/2017.
 */
var datatables_spanish = {
    "sProcessing": "Procesando...",
    "sLengthMenu": "Mostrar _MENU_ registros",
    "sZeroRecords": "No se encontraron resultados",
    "sEmptyTable": "Ningún dato disponible en esta tabla",
    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
    "sInfoPostFix": "",
    "sSearch": "Buscar:",
    "sUrl": "",
    "sInfoThousands": ",",
    "sLoadingRecords": "Cargando...",
    "oPaginate": {
        "sFirst": "Primero",
        "sLast": "Último",
        "sNext": "Siguiente",
        "sPrevious": "Anterior"
    },
    "oAria": {
        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }
};

var opciones = function () {
    return '<td>' +
        '<button type="button" class="btn btn-success glyphicon glyphicon glyphicon-shopping-cart" data-toggle="tooltip" data-placement="top" title="Vender"></button> ' +
        '<button type="button" class="btn btn-danger glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" title="Eliminar"></button>' +
        '</td>';
}
$('[data-toggle="tooltip"]').tooltip();
$(document).ready(function () {

    var tabla = $("#tablaReservaciones").DataTable({
        "ajax": {
            "url": "/reservacion/lista",
            "dataSrc": ""
        },
        "columns": [
            {"data": "smartphone.marca"},
            {"data": "smartphone.modelo"},
            {"data": "smartphone.precio"},
            {"data": "usuario.correo"},
            {"data": "fecha"},
            {
                data: null,
                className: "center",
                defaultContent: opciones()
            }
        ],
        'language': datatables_spanish,
        'aoColumnDefs': [{'bSortable': false, 'aTargets': [4]}]
    });

    $("#tablaReservaciones").on("click", ".btn-danger", function () {
        var datos = tabla.row($(this).parents("tr")).data();
        var texto = datos.smartphone.marca + " " + datos.smartphone.modelo + " $" + datos.smartphone.precio +
            "\nUsuario: " + datos.usuario.correo;
        swal({
                title: "¿Estas seguro de eliminar esta Reservación?",
                text: texto,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, estoy seguro",
                closeOnConfirm: false
            },
            function () {
                $.post("/reservacion/eliminar",
                    {id: datos.idReservacion}
                    , function () {
                        tabla.ajax.reload();
                        swal("¡Se ha eliminado!", "", "success");
                    });
            });
    });


    $("#tablaReservaciones").on("click", ".btn-success", function () {
        var datos = tabla.row($(this).parents("tr")).data();
        var texto = datos.smartphone.marca + " " + datos.smartphone.modelo + " $" + datos.smartphone.precio;

        swal({
                title: "¿Esta seguro de Registrar esta Venta?",
                text: texto,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#7DCEA0",
                confirmButtonText: "Si, estoy seguro",
                closeOnConfirm: false
            }
            , function () {
                $.post("/venta/registrar",
                        {idSmartphone: datos.smartphone.idSmartphone,
                        idUsuario: datos.usuario.idUsuario},
                    function () {
                        $.post("/reservacion/eliminar",
                            {id: datos.idReservacion}, function () {
                                tabla.ajax.reload();
                                swal("!Exito al registrar la Venta¡", "", "success");
                            });
                    }
                );
            });
    });


});
