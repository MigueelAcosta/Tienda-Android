var datatables_spanish = {
    "sProcessing": "Procesando...",
    "sLengthMenu": "Mostrar _MENU_ registros",
    "sZeroRecords": "No se encontraron resultados",
    "sEmptyTable": "Ningún dato disponible en esta tabla",
    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
    "sInfoPostFix": "",
    "sSearch": "Buscar:",
    "sUrl": "",
    "sInfoThousands": ",",
    "sLoadingRecords": "Cargando...",
    "oPaginate": {
        "sFirst": "Primero",
        "sLast": "Último",
        "sNext": "Siguiente",
        "sPrevious": "Anterior"
    },
    "oAria": {
        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }
};

var opciones = function () {
    return '<td>' +
        '<button type="button" class="btn btn-danger glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" title="Eliminar"></button>' +
        '</td>';
}
$('[data-toggle="tooltip"]').tooltip();
$(document).ready(function () {
    var tabla = $("#tablaAdquisiciones").DataTable({
        "ajax": {
            "url": "/adquisicion/lista",
            "dataSrc": ""
        },
        "columns": [
            {"data": "idAdquisicion"},
            {"data": "producto"},
            {"data": "proveedor"},
            {"data": "precio"},
            {"data": "cantidad"},
            {"data": "fecha"},
            {
                data: null,
                className: "center",
                defaultContent: opciones()
            }
        ],
        'language': datatables_spanish,
        'aoColumnDefs': [{'bSortable': false, 'aTargets': [6]}]
    });


    $("#tablaAdquisiciones").on("click", ".btn-danger", function () {
        var datos = tabla.row($(this).parents("tr")).data();
        var texto = "Producto: "+datos.producto +
                    "\nProveedor: " + datos.proveedor;
        swal({
                title: "¿Estas seguro de eliminar?",
                text: texto,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, estoy seguro",
                closeOnConfirm: false
            },
            function () {
                $.post("/adquisicion/eliminar",
                    {id: datos.idAdquisicion}
                    , function () {
                        tabla.ajax.reload();
                        swal("¡Se ha eliminado la adquisición!", "", "success");
                    });
            });
    });

    $("#btnAgregar").click(function () {
        $("#modalTitulo").html("Registrar Adquisición");
        $("#btnGuardar").html("Agregar");
        $("#inputProducto").val("");
        $("#inputProveedor").val("")
        $("#inputPrecio").val("");
        $("#inputCantidad").val("");
        $("#modalRegistro").modal("show");
    });

    $("#btnGuardar").click(function () {
        var producto = $("#inputProducto").val();
        var proveedor = $("#inputProveedor").val();
        var precio = $("#inputPrecio").val();
        var cantidad = $("#inputCantidad").val();

        if (producto == "" || proveedor == "" || precio == "" || cantidad == "") {
            swal("Advertencia", "Por favor llene todos los campos", "error");
        } else {
            var adquisicion = {
                "producto": producto,
                "proveedor": proveedor,
                "precio": precio,
                "cantidad": cantidad,
            };

            $.post("/adquisicion/guardar",
                adquisicion
                , function () {
                    tabla.ajax.reload();
                    swal("¡Se ha registrado una nueva adquisición!", "", "success");
                    $("#modalRegistro").modal("hide");
                });

        }
    });
});
